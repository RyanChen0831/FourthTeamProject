@*更改*@

@{
	ViewData["Title"] = "寵物商城";

	ViewData["UserIsInShoppingPage"] = true;

}

@section Styles
	{
	<link href="~/css/style.css" rel="stylesheet" />
}

<!-- shopping list container -->
<div id="app">

<!-- search & shoppingcart -->

<nav class="navbar navbar-expand-lg navbar-light bg-light">
	<div class="col-md-12">
		<div class="row">
			<div class="col-md-4">
				<div class="input-group mb-3">
					<input type="text" class="form-control" placeholder="請輸入關鍵字" aria-label="Recipient's username" aria-describedby="button-addon2">
					<div class="input-group-append">
						<button class="btn btn-primary" type="button" id="button-addon2">Search</button>
					</div>
				</div>
			</div>

			<!-- shoppingcart -->

			<div class="dropdown ml-auto float-right">
				<button class="btn btn-cart" data-toggle="dropdown">
					<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cart4" viewBox="0 0 16 16">
						<path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5zM3.14 5l.5 2H5V5H3.14zM6 5v2h2V5H6zm3 0v2h2V5H9zm3 0v2h1.36l.5-2H12zm1.11 3H12v2h.61l.5-2zM11 8H9v2h2V8zM8 8H6v2h2V8zM5 8H3.89l.5 2H5V8zm0 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0z" />
					</svg>
						<span class="badge badge-pill badge-danger">{{listConut}}</span>
				</button>

				<div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuReference" style="min-width:400px;">
					<div class="px-4 py-3">
						<table class="table">
							<thead>
								<tr>
									<th scope="col"></th>
									<th scope="col">商品名稱</th>
									<th scope="col">數量</th>
									<th scope="col">小計</th>
								</tr>
							</thead>
							<tbody>
								<tr v-for="cartItem in shoppingCart">
									<th scope="row" >
											<a data-toggle="modal" data-target="#removeModal" data-whatever="" @@click="Remove()">
											<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
												<path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z" />
											</svg>
										</a>
									</th>
									<td>{{cartItem[0].productName}}</td>
									<td>{{cartItem[0].amount}}</td>
									<td class="text-right">{{cartItem[0].price}}</td>									
								</tr>
							</tbody>
						</table>
						<a href="ShoppingCart/Check/" class="btn btn-primary btn-block">結帳去</a>
					</div>
				</div>
			</div>
		</div>
</nav>
<!-- fiiter -->
	<div class="containershop">
		<section class="left">
			<div class="col-xl-3 col-lg-4 col-md-7">
				<div class="sidebar-box-style2">
					<!--Start Single Sidebar style2-->
					<div class="single-sidebar-style2">
						<div class="title">
							<h4>寵物類型</h4>
						</div>
						<ul class="filter-checkbox">
							<li>
								<div class="single-checkbox">
									<input type="checkbox" id="all" checked>
									<label for="all"><span></span>All</label>
								</div>
							</li>
							<li>
								<div class="single-checkbox">
									<input type="checkbox" id="dog">
									<label for="dog"><span></span>Dogs</label>
								</div>
							</li>
							<li>
								<div class="single-checkbox">
									<input type="checkbox" id="cat">
									<label for="cat"><span></span>Cats</label>
								</div>
							</li>
						</ul>

						<div class="title">
							<h4>商品類型</h4>
						</div>
						<ul class="filter-checkbox">
							<li>
								<div class="single-checkbox">
									<input type="checkbox" id="allP" checked>
									<label for="allP"><span></span>All</label>
								</div>
							</li>
							<li>
								<div class="single-checkbox">
									<input type="checkbox" id="food">
									<label for="food"><span></span>Food</label>
								</div>
							</li>
							<li>
								<div class="single-checkbox">
									<input type="checkbox" id="item">
									<label for="item"><span></span>Items</label>
								</div>
							</li>
							<li>
								<div class="single-checkbox">
									<input type="checkbox" id="health">
									<label for="health"><span></span>HealthCare</label>
								</div>
							</li>
						</ul>
					</div>
				</div>
             </div>
				<!--End Single Sidebar style2-->
		</section>

<!-- product cards -->


	<section class="right">
		<ul class="card-group row px-4 pt-4" >
			<li class="col-4 d-flex align-items-stretch" v-for="item in ProductList">
				<div class="card">
					<div class="pic">
						<img src="https://picsum.photos/300/?random=10">
					</div>
					<div class="card-body">
						<h3 class="title">
							{{item.productName}}
						</h3>
					</div>
					<div class="card-footer">
						<p class="text">
							{{item.unitPrice}}
						</p>
						<div>
							<button class="round" @@click="minusOne(item)">-</button>
							<span>{{ item.amount }}</span>
							<button class="round" @@click="addOne(item)">+</button>
						</div>
						<button class="btn btn-primary" @@click="AddCart(item)">AddCart</button>
					</div>
				</div>
			</li>
		</ul>
	</section>
	</div>

<!-- Pages	 -->

<nav aria-label="Page navigation example">
	<ul class="pagination">
		<li class="page-item">
			<a class="page-link" href="#" aria-label="Previous">
				<span aria-hidden="true">&laquo;</span>
			</a>
		</li>
		<li class="page-item"><a class="page-link" href="#">1</a></li>
		<li class="page-item"><a class="page-link" href="#">2</a></li>
		<li class="page-item"><a class="page-link" href="#">3</a></li>
		<li class="page-item">
			<a class="page-link" href="#" aria-label="Next">
				<span aria-hidden="true">&raquo;</span>
			</a>
		</li>
	</ul>
</nav>
</div>













@section Scripts
    {
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
		var baseAddress = 'https://localhost:7089/Product';
        var vueApp = new Vue({
            el: "#app",
            data: {
                filter: '',
                ProductList: [],
                shoppingCart: [],
				listConut:0
            },
            mounted: function () { //掛載虛擬DOM元素有點類似於$().ready();
                let _this = this;
                _this.display();
            },
            methods: {
                //商品列表顯示
                display: function () {
					axios.post('api/PetProdcutAPI/GetProduct').then(response => {
                        let _this = this; //指的是Vue本身。
                        _this.ProductList = response.data;
                        console.log(_this.ProductList);
                    });
                },

                //減商品數量
                minusOne: function (item) {
                    item.amount--;
                    return item.amount = (item.amount < 1) ? 1 : item.amount				
                },

                //加商品數量
                addOne: function (item) {
                    item.amount++;
                    return item.amount = (item.amount > 9) ? 9 : item.amount
                },

                //加入購物車
                AddCart: function (item) {
					Swal.fire({
						position: 'center',
						icon: 'success',
						title: '成功加入購物車',
						showConfirmButton: false,
						timer: 1000
					})
                    let _this = this
                    // 建立包含產品ID的請求物件，需要與API所要求的參數型態屬性相同。否則會為BadRequset。
                    var requset = {
						ProductId: item.productId,
						ProductName: item.productName,
						ProductContent: item.productContent,
						UnitPrice: item.unitPrice,
						Amount: item.amount,
					};
                    console.log(requset);
					axios.post('api/ShoppingCartAPI/AddCart',requset).then(response => {
                        //console.log(response.data);
						_this.shoppingCart.push(response.data);
						_this.listConut = _this.shoppingCart.length;
                    });
                },					

				Remove:function(){
					shoppingCart.remove();
				}

            },




        })
    </script>
}