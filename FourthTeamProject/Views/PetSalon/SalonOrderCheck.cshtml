@section  Styles{

    <style>
        .td-Width {
            width: 150px;
        }

        .card {
            margin-bottom: 10px;
        }

    </style>

}


<header class="bg-dark text-white py-3">
    <h2 class="text-center font-weight-bold">美容訂單確認</h2>
</header>

<div id="app" class="container mt-4">
    <div class="row">
        <div class="col-md-10">
            <table class="table" style="text-align:center">
                <thead>
                    <tr>
                        <th>美容服務</th>
                        <th>服務介紹</th>
                        <th>價格</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="SalonItem in SalonSolutionOrder">
                        <template>
                            <td>{{SalonItem.salonSolutionName}}</td>
                            <td>{{SalonItem.salonSolutionDiscription}}</td>
                            <td>{{SalonItem.salonSolutionPrice}}</td>
                        </template>
                    </tr>
                </tbody>
            </table>
            <div class="mt-4">
                <h4>訂購人資料</h4>
                <div class="form-group">
                    <label for="name">姓名：</label>
                    <input type="text" class="form-control" id="name" name="name" v-model="member.name" required>
                </div>
                <div class="form-group">
                    <label for="phone">連絡電話：</label>
                    <input type="tel" class="form-control" id="phone" name="phone" v-model="member.phone" required>
                </div>
                <div class="form-group">
                    <label for="address">信箱：</label>
                    <input type="email" class="form-control" id="Email" name="Email" v-model="member.email" required>
                </div>
                <div class="form-group">
                    <label for="address">寵物名子：</label>
                    <input type="text" class="form-control" id="CatagoryName" name="CatagoryName" v-model="salonCatagoryName" :min="currentDate" required>
                </div>
                <div class="form-group">
                    <label for="address">美容預約日期：</label>
                    <input type="date" v-model="orderDetailData" class="form-control custom-select" style="font-size:15px;" required>
                </div>
                <label for="phone">發票類型：</label>
                <div class="form-group" v-for="item in invoiceType">
                    <span></span>{{item.invoiceName}}
                    <input type="radio" name="invoice" v-model="invoice" :value="item.invoiceId" required>
                </div>
                <label for="phone">付款方式：</label>
                <div class="form-group" v-for="item in paymentType">
                    <span></span>{{item.payName}}
                    <input type="radio" name="payment" v-model="payment" :value="item.payId" required>
                </div>
                <button class="btn btn-primary btn-block" @@click="sendOrder">送出訂單</button>
            </div>
        </div>
    </div>

</div>




<script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.2/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js" integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS" crossorigin="anonymous"></script>
<script>
    let app = new Vue({
        el: "#app",
        data: {
            member: [],
            SalonSolutionOrder: [],
            invoiceType: [],
            paymentType: [],
            salonCatagoryName: "",
            orderDetailData: "",
            invoice: "",
            payment: "",
        },
        mounted() {
            let _this = this;
            const urlParams = new URLSearchParams(window.location.search);
            const urlmemberdata = urlParams.get("member");
            const urlorderdata = urlParams.get("orderData");
            const memberdata = JSON.parse(decodeURIComponent(urlmemberdata));
            const orderdata = JSON.parse(decodeURIComponent(urlorderdata));
            console.log(memberdata);
            console.log(orderdata);
            _this.member = memberdata;
            _this.SalonSolutionOrder = orderdata;
            axios.post('/api/PetProdcutAPI/getInvoice').then(response => _this.invoiceType = response.data);
            axios.post('/api/PetProdcutAPI/getPayment').then(response => _this.paymentType = response.data);
        },
        //computed: {
        //    currentDate() {
        //        const today = new Date();
        //        const year = today.getFullYear();
        //        const month = String(today.getMonth() + 1).padStart(2, '0');
        //        const day = String(today.getDate()).padStart(2, '0');
        //        return `${year}-${month}-${day}`;
        //    }
        //},
        methods: {
            sendOrder: function () {
                let _this = this;
                var order = {
                    SalonOrderID: 0,
                    MemberId: _this.member.id,
                    PayId: _this.payment,
                    InvoiceId: _this.invoice,
                    OrderMemberName: _this.member.name,
                    OrderMemberPhone: _this.member.phone,
                    OrderMemberEmail: _this.member.email,
                };
                //var Detail = {
                //    SalonOrderDetailId : 0,
                //    Appointment: _this.orderDetailData,
                //    UnitPrice: _this.SalonSolutionOrder.salonSolutionPrice,
                //    SalonOrderId : OrderDetail.SalonOrderID,
                //    SalonSolutionId : OrderDetail.SalonSolutionID,
                //    SalonCatagoryName: _this.salonCatagoryName,
                //    SalonSolutionName: _this.SalonSolutionOrder.salonSolutionName,
                //};
                axios.post(`/api/SalonClient/Getorder`, order)
                .then(response =>{
                        alert(response.data);
                     const url = `/Home/Index`;
                    window.location.href = url;})
                //axios.post(`/api/SalonClient/GetorderDetail`, Detail).then(response => _this.SalonSolutionDTO = response.data);

            },

        }
    });
</script>

